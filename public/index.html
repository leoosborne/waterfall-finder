<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="web-app using weather and mapping APIs to determine when intermittent waterfalls are flowing">
  <title>Waterfall Finder | Home</title>
  <link rel="stylesheet" href="/css/styles.css" type="text/css">
</head>
<body class="ff-primary"> 
  <div class="mobile-container"> 
    <header class="primary-header">       
      <div class="container">
         <div class="nav-wrapper bg-accent-900">
              <a href="index.html" class="logo"><img src="/img/leocast-lion-head-and-text-linear.webp" alt="LeoCast LLC's logo"></a>
              <button class="mobile-nav-toggle" aria-controls="primary-navigation" aria-expanded="false">
                  <span class="visually-hidden">Menu</span>
              </button>
              <nav id="primary-navigation" class="primary-navigation">
                  <ul aria-label="Primary" class="nav-list">
                      <li class="nav-item"><a href="index.html#work">[to come]</a></li>
                      <li class="nav-item"><a href="index.html#about">[to come]</a></li>
                      <li class="nav-item"><a href="index.html#contact">[to come]</a></li>
                  </ul>
              </nav>
          </div>
      </div>
  </header>

  <main>
    <section class="container hero-container">
      <h1 class="fs-mobile-h1 
      ff-heading heading txt-accent-500 fw-semibold">Waterfall Finder</h1>
      
    </section>

    <section class=" section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">Where, and also When</h3>
      <p class="fs-body-md ff-body txt-dark-600 ">There is something wonderous about a waterfall — tugging on those of us who appreciate the natural world — when water, heading gravity's pull, slowly carves its stories into stone. Among the most magical are the intermittent waterfalls. Most of them hidden deep in the woods, on unnamed watercourses, fed only by a chance rainstorm, bursting into life for a short time, then quickly draining the hillside and leaving only their paths cut into rock over millions of years as evidence. To expereince these fleeting wonders, one must not only know <span class="fw-bold">where</span>
         to find them, but <span class="fw-bold">when</span>  to go looking for them. </p> 
      <p class="fs-body-md ff-body txt-dark-600 ">Waterfall Finder tries to take the guesswork out of chasing waterfalls. We share the secrets of where and when in hopes you will choose to seek out some of these lesser seen waterfalls in their delicate, fleeting brilliance. We believe that the more people who expereince and are delighted by these special places, the better chance we have of protecting them.</p>
    </section>

    <section id="mammothCave" class=" section-container">
      <h2 class="fs-mobile-h2 ff-heading heading txt-accent-500 fw-semibold">Mammoth Cave National Park</h2>
      <article class="square-wrap-left">
        <img src="img/section-first-cascade.jpg" alt="Photo of Twister Falls, Mammoth Cave National Park">
          <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis.</p>
      </article>
      <article class="square-wrap-right">        
          <img class= "park-map-mobile" src="/img/park-map-mobile.jpg" alt="A map of Mammoth Cave National Park with a blue highlighted section around the First Creek area">                 
          <h3 class="fs-mobile-h3 ff-heading txt-dark-600">Above Ground at Mammoth Cave</h3>
          <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo.Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. </p>
      </article>
      <article>
        
          <h1>Recent Rainfall</h1>
            <canvas id="rainDataChart" width="400" height="200"></canvas> <!-- Add canvas element for the bar chart -->
            <table style="width:100%"  class="fs-body-md ff-body txt-secondary-900">      
            <tr>
              <td>Rainfall total yesterday: </td>
              <td id="42210"></td>
            </tr>
            <tr>
              <td>Are the Falls Flowing?</td>
              <td id="42210-is-flowing"></td> 
            </tr>
          </table>
          <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo.</p>
       
      </article>
      <article class="square-wrap-right">
      <div id="rainData"></div>
     
      <table style="width:100%" class="fs-body-md ff-body txt-secondary-900">     
        <tr>
          <td>Rainfall total yesterday: </td>
          <td id="40206"></td>
        </tr>
        <tr>
          <td>Are the Falls Flowing?</td>
          <td id="40206-is-flowing"></td>
        </tr>
    </article>
    
    </section>  
    <section id="firstCreek" class="section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">The Falls of First Creek</h3>
      <figure>
        <img class="park-map-mobile"  src="/img/First-Creek-MCNP-map-mobile-2.jpg" alt="A map of waterfal loctions, in or near First Creek, Mammoth Cave National Park">
        <figcaption class="fs-100 txt-dark-600">Waterfalls along or near the First Creek drainage.</figcaption>
      </figure>
      <figure>
        <img class="thumb-carosel" src="/img/thumb-carosel.jpg" alt="A horizontal scrobalble list of thumbnail images of waterfalls with links to more information on each.">
      </figure>
      <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
    </section>

    <section class=" section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">Casper Falls</h3>
      <figure>
        <img class="park-map-mobile"  src="/img/hero-casper-mobile.jpg" alt="A photo of Casper Falls near First Creek, Mammoth Cave National Park">
        <figcaption class="fs-100 txt-dark-600">Casper Falls in late winter.</figcaption>
      </figure>
      <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
     
       <table style="width:100%" class="fs-body-md ff-body txt-dark-600">
        <tr>
          <td>Type of Falls</td>
          <td>Ledge</td>
        </tr>
        <tr>
          <td>Height of Falls</td>
          <td>Est. 35 feet</td>
        </tr>
        <tr>
          <td>Width of Falls</td>
          <td>Est. 12 feet</td>
        </tr>        <tr>
          <td>Number of Drops</td>
          <td>2</td>
        </tr>
        <tr>
          <td>Water Course</td>
          <td>Unnamed</td>
        </tr>        <tr>
          <td>Type of Hike</td>
          <td>Bushwack</td>
        </tr>
        <tr>
          <td>Trailhead GPS</td>
          <td>37.24404, -86.19084</td>
        </tr> 
        <tr>
          <td>Waterfall GPS</td>
          <td>37.23832, -86.191993</td>
        </tr> 
        <tr>
          <td>Name of Land</td>
          <td>Mammoth Cave National Park</td>
        </tr>
        <tr>
          <td>Land Owner</td>
          <td>Dept. of Interior</td>
        </tr>        <tr>
          <td>County</td>
          <td>Edmonson</td>
        </tr>
        <tr>
          <td>State</td>
          <td>Kentucky</td>
        </tr>
      </table> 
    </section>

  </main>

  <footer>
    <!-- Add your footer content here -->
  </footer>
</div>  <!-- end of mobile-container -->

<script type="module" src="/js/nav.js"></script>  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Include Chart.js from CDN -->
<script>
  // after the accuweather API call in server.js, this updates the daily rainfall data (value and unit) for each zip code
  fetch('api/recentRain')
      .then(response => response.json())
      .then(data => {
          let rainDataMap = data.rainDataMap;
          for (let [zipcode, rainData] of rainDataMap) {
              document.getElementById(zipcode.toString()).textContent = rainData.value + " " + rainData.unit;
              console.log(zipcode);//shows zipcode(s) in console of localhost:3000
          }
      })
      .catch(error => { 
          console.error(error);
          // Handle the error
    });
</script>

<script>
  // Function to fetch historical rain data
  async function fetchHistoricalRainData() {
    try {
      const response = await fetch('/api/historicalRain');
      const data = await response.json();
      return data;
    } catch (error) {
      console.error('Error fetching historical rain data:', error);
      return [];
    }
  }

  // Function to render the bar chart
  function renderBarChart(historicalData) {
    const ctx = document.getElementById('rainDataChart').getContext('2d');

    const labels = [];
    const values = [];

    historicalData.forEach((entry) => {
      const timestamp = entry[0];
      const dataMap = new Map(entry[1]);

      labels.push(new Date(parseInt(timestamp)).toLocaleDateString());
      values.push(dataMap.get(zipArr[0]).value);
    });

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Rainfall (inches)',
          data: values,
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  // On page load, fetch and render historical rain data as a bar chart
  document.addEventListener('DOMContentLoaded', async () => {
    const historicalRainData = await fetchHistoricalRainData();
    renderBarChart(historicalRainData);
  });


  // Async/Await Function to fetch rain flow status
  async function fetchRainFlowStatus() {
    try {
      const response = await fetch('/api/rainFlowStatus');
      const data = await response.json();
      return data;
      console.log(data);//cannot find this console.log
    } catch (error) {
      console.error('Error fetching rain flow status:', error);
      return [];
    }
  }

  // Promise function to fetch rain flow status
  // fetch('/api/rainFlowStatus')
  //   .then(response => response.json)
  //   .then(data => {
  //     let rainFlowStatus = data.rainFlowStatus;
  //     for (let [zipcode, rainData] of rainFlowStatus) {
  //       document.getElementById(zipcode.toString()).textContent = rainData.rainFlowStatus;
  //       console.log(rainData.rainFlowStatus);
  //     }
  //   })
  //     .catch(error => { 
  //         console.error(error);
  //         // Handle the error
  //   });
// Function to update the rain flow status in the table; updated code
function updateRainFlowStatus(rainFlowStatus) {
    rainFlowStatus.forEach(([zipcode, status]) => {
      const rowId = `${zipcode}-is-flowing`;
      document.getElementById(rowId).textContent = status;
    });
  }
  // Function to update the rain flow status in the table; original code
  // function updateRainFlowStatus(rainFlowStatus) {
  //   for (let [zipcode, status] of rainFlowStatus) {
  //     const rowId = `${zipcode}-is-flowing`;
  //     document.getElementById(rowId).textContent = status;
  //   }
  // }

  // On page load, fetch and update rain flow status
  document.addEventListener('DOMContentLoaded', async () => {
    const rainFlowStatus = await fetchRainFlowStatus();
    updateRainFlowStatus(rainFlowStatus);
  });

</script>
</body>
</html>