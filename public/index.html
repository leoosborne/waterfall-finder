<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="web-app using weather and mapping APIs to determine when intermittent waterfalls are flowing">
  <title>Waterfall Finder | Home</title>
  <link rel="stylesheet" href="/css/styles.css" type="text/css">
</head>
<body class="ff-primary"> 
  <div class="mobile-container"> 
    <header class="primary-header">       
      <div class="container">
         <div class="nav-wrapper bg-accent-900">
              <a href="index.html" class="logo"><img src="/img/leocast-lion-head-and-text-linear.webp" alt="LeoCast LLC's logo"></a>
              <button class="mobile-nav-toggle" aria-controls="primary-navigation" aria-expanded="false">
                  <span class="visually-hidden">Menu</span>
              </button>
              <nav id="primary-navigation" class="primary-navigation">
                  <ul aria-label="Primary" class="nav-list">
                      <li class="nav-item"><a href="index.html#work">[to come]</a></li>
                      <li class="nav-item"><a href="index.html#about">[to come]</a></li>
                      <li class="nav-item"><a href="index.html#contact">[to come]</a></li>
                  </ul>
              </nav>
          </div>
      </div>
  </header>

  <main>
    <section class="container hero-container">
      <h1 class="fs-mobile-h1 
      ff-heading heading txt-accent-500 fw-semibold">Waterfall Finder</h1>
      <h2 class="fs-mobile-h2 ff-heading heading txt-accent-500 fw-semibold">Mammoth Cave National Park</h2>
      <div>
        <!-- Add your photos dynamically using JavaScript -->
      </div>
    </section>

    <section class=" section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">What and Why</h3>
      <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
    </section>

    <section id="mammothCave" class=" section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">Above Ground at Mammoth Cave</h3>
      <figure>
        <img class="park-map-mobile"  src="/img/park-map-mobile.jpg" alt="A map of Mammoth Cave National Park with a blue highlighted section around the First Creek area">
        <figcaption class="fs-100 txt-dark-600">Mammoth Cave National Park, with highlighted section of the First Creek area.</figcaption>
      </figure>

     

      <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
      <table style="width:100%" class="fs-body-md ff-body txt-secondary-900">
        <tr>
          <td>Rainfall total yesterday: </td>
          <td id="42210"></td>
        </tr>
        <tr>
           <td>Are the Falls Flowing?</td>
           <td id="42210-is-flowing"></td> 
        </tr>
      </table>
      <h1>Recent Rainfall</h1>
<canvas id="rainDataChart" width="400" height="200"></canvas> <!-- Add canvas element for the bar chart -->
<div id="rainData"></div>
      <!-- <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
      <table style="width:100%" class="fs-body-md ff-body txt-secondary-900">
        <tr>
          <td>Rainfall total yesterday: </td>
          <td id="40206"></td>
        </tr>
        <tr>
          <td>Are the Falls Flowing?</td>
          <td>Yes!</td>
        </tr>
      </table>
      <figure>
        <img class="park-map-mobile"  src="/img/chart-placeholder.png" alt="A line chart showing the amount of rainfall in the area over the last few days.">
        <figcaption class="fs-100 txt-dark-600">Amount of rainfall over the past five days.</figcaption>
       </figure> -->
    </section>

    <div id="app"></div>

    <section class=" section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">The Falls of First Creek</h3>
      <figure>
        <img class="park-map-mobile"  src="/img/First-Creek-MCNP-map-mobile-2.jpg" alt="A map of waterfal loctions, in or near First Creek, Mammoth Cave National Park">
        <figcaption class="fs-100 txt-dark-600">Waterfalls along or near the First Creek drainage.</figcaption>
      </figure>
      <figure>
        <img class="thumb-carosel" src="/img/thumb-carosel.jpg" alt="A horizontal scrobalble list of thumbnail images of waterfalls with links to more information on each.">
      </figure>
      <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
    </section>

    <section class=" section-container">
      <h3 class="fs-mobile-h3 ff-heading txt-dark-600">Casper Falls</h3>
      <figure>
        <img class="park-map-mobile"  src="/img/section-casper-mobile.jpg" alt="A photo of Casper Falls near First Creek, Mammoth Cave National Park">
        <figcaption class="fs-100 txt-dark-600">Casper Falls in late winter.</figcaption>
      </figure>
      <p class="fs-body-md ff-body txt-dark-600">Curabitur tempor quis eros tempus lacinia. Nam bibendum pellentesque quam a convallis. Sed ut vulputate nisi. Integer in felis sed leo vestibulum venenatis. Nulla varius volutpat turpis sed lacinia. Nam eget mi in purus lobortis eleifend. Sed nec ante dictum sem condimentum ullamcorper quis venenatis nisi. Proin vitae facilisis nisi, ac posuere leo. <button class="text-button" ><span class="txt-secondary-800 button">MORE</span></button></p>
     
       <table style="width:100%" class="fs-body-md ff-body txt-dark-600">
        <tr>
          <td>Type of Falls</td>
          <td>Ledge</td>
        </tr>
        <tr>
          <td>Height of Falls</td>
          <td>Est. 35 feet</td>
        </tr>
        <tr>
          <td>Width of Falls</td>
          <td>Est. 12 feet</td>
        </tr>        <tr>
          <td>Number of Drops</td>
          <td>2</td>
        </tr>
        <tr>
          <td>Water Course</td>
          <td>Unnamed</td>
        </tr>        <tr>
          <td>Type of Hike</td>
          <td>Bushwack</td>
        </tr>
        <tr>
          <td>Trailhead GPS</td>
          <td>37.24404, -86.19084</td>
        </tr> 
        <tr>
          <td>Waterfall GPS</td>
          <td>37.23832, -86.191993</td>
        </tr> 
        <tr>
          <td>Name of Land</td>
          <td>Mammoth Cave National Park</td>
        </tr>
        <tr>
          <td>Land Owner</td>
          <td>Dept. of Interior</td>
        </tr>        <tr>
          <td>County</td>
          <td>Edmonson</td>
        </tr>
        <tr>
          <td>State</td>
          <td>Kentucky</td>
        </tr>
      </table> 
    </section>

  </main>

  <footer>
    <!-- Add your footer content here -->
  </footer>
</div>  <!-- end of mobile-container -->

<script type="module" src="/js/nav.js"></script>  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Include Chart.js from CDN -->
<script>
  // after the accuweather API call in server.js, this updates the daily rainfall data (value and unit) for each zip code
  fetch('api/recentRain')
      .then(response => response.json())
      .then(data => {
          let rainDataMap = data.rainDataMap;
          for (let [zipcode, rainData] of rainDataMap) {
              document.getElementById(zipcode.toString()).textContent = rainData.value + " " + rainData.unit;
              console.log(zipcode);
          }
      })
      .catch(error => { 
          console.error(error);
          // Handle the error
    });
</script>

<script>
  // Function to fetch historical rain data
  async function fetchHistoricalRainData() {
    try {
      const response = await fetch('/api/historicalRain');
      const data = await response.json();
      return data;
    } catch (error) {
      console.error('Error fetching historical rain data:', error);
      return [];
    }
  }

  // Function to render the bar chart
  function renderBarChart(historicalData) {
    const ctx = document.getElementById('rainDataChart').getContext('2d');

    const labels = [];
    const values = [];

    historicalData.forEach((entry) => {
      const timestamp = entry[0];
      const dataMap = new Map(entry[1]);

      labels.push(new Date(parseInt(timestamp)).toLocaleDateString());
      values.push(dataMap.get(zipArr[0]).value);
    });

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Rainfall (inches)',
          data: values,
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        scales: {
          x: {
            grid: {
              display: false
            }
          },
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  // On page load, fetch and render historical rain data as a bar chart
  document.addEventListener('DOMContentLoaded', async () => {
    const historicalRainData = await fetchHistoricalRainData();
    renderBarChart(historicalRainData);
  });


  // Function to fetch rain flow status
  async function fetchRainFlowStatus() {
    try {
      const response = await fetch('/api/rainFlowStatus');
      const data = await response.json();
      return data;
      console.log(data);
    } catch (error) {
      console.error('Error fetching rain flow status:', error);
      return [];
    }
  }

  // Function to update the rain flow status in the table
  function updateRainFlowStatus(rainFlowStatus) {
    for (let [zipcode, status] of rainFlowStatus) {
      const rowId = `${zipcode}-is-flowing`;
      document.getElementById(rowId).textContent = status;
      console.log(`rowId${rowID}`);
    }
  }

  // On page load, fetch and update rain flow status
  document.addEventListener('DOMContentLoaded', async () => {
    const rainFlowStatus = await fetchRainFlowStatus();
    updateRainFlowStatus(rainFlowStatus);
  });

</script>
</body>
</html>
